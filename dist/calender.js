(()=>{window.onload=()=>{const e=document.querySelector(".user-name"),t=document.querySelector(".user-pic");fetch("user-name").then((e=>e.json())).then((n=>{e.innerHTML=n.user,t.setAttribute("src",`data:${n.ptype};base64,${n.profile}`)})).catch((e=>console.log(e.message)))};const e=["January","February","March","April","May","June","July","August","September","October","November","December"];let t=(new Date).getMonth(),n=(new Date).getFullYear();const a=()=>{let a=document.querySelector(".month"),r=document.querySelector(".year");a.textContent=e[t],r.textContent=`${n}`},r=async()=>{const e=new Date(n,t+1,0).getDate(),a=document.querySelector(".cal-days");a.innerHTML="";const r=await fetch(`/tasks?year=${n}&month=${t+1}`),o=await r.json(),c={};o.forEach((e=>{const t=new Date(e.duedate),n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;c[n]||(c[n]=[]),c[n].push(e)}));const d=new Date(n,t,1).getDay(),s=0===d?6:d-1,l=new Date(n,t,0).getDate();for(let e=0;e<s;e++){const t=document.createElement("div");t.classList.add("cal-day","prev-month-day"),t.textContent=l-s+e+1,a.append(t)}for(let r=0;r<e;r++){const e=document.createElement("div");e.classList.add("cal-day"),e.textContent=r+1,a.append(e);const o=`${n}-${String(t+1).padStart(2,"0")}-${String(r+1).padStart(2,"0")}`;c[o]&&(e.classList.add("cal-task-day"),e.addEventListener("mouseover",(()=>{c[o].forEach((e=>{const t=document.getElementById("c-d");e.priority=!0===e.priority?"Yes":"No";const n=new Date(e.createdAt).toDateString(),a=new Date(e.duedate).toDateString();t.innerHTML=`Task title: ${e.title} <br> \n                        Created On: ${n} <br>\n                        Priority: ${e.priority} <br>\n                        Due Before: ${a}`}))})),e.addEventListener("mouseleave",(()=>{document.getElementById("c-d").textContent=""})))}};document.getElementById("cal-prev").addEventListener("click",(()=>{t--,t<0&&(t=11,n--),a(),r()})),document.getElementById("cal-next").addEventListener("click",(()=>{t++,t>11&&(t=0,n++),a(),r()})),a(),r()})();